@tailwind base;
@tailwind components;
@tailwind utilities;

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

@layer base {
  :root {
    /* Ernest Cyber - Style WeWeb App */
    --background: 0 0% 100%;
    --foreground: 0 0% 20%;

    --card: 0 0% 100%;
    --card-foreground: 0 0% 20%;

    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 20%;

    /* Primary color - #3b82f6 */
    --primary: 217 91% 60%;
    --primary-foreground: 0 0% 100%;
    --primary-glow: 217 91% 70%;

    /* Success - Correct answers */
    --success: 142 71% 45%;
    --success-foreground: 0 0% 100%;
    --success-light: 142 71% 98%;

    /* Warning - Tips & hints */
    --warning: 38 92% 50%;
    --warning-foreground: 0 0% 100%;
    --warning-light: 38 92% 98%;

    /* Error - Gentle mistakes */
    --error: 0 72% 51%;
    --error-foreground: 0 0% 100%;
    --error-light: 0 72% 99%;

    --secondary: 0 0% 100%;
    --secondary-foreground: 0 0% 20%;

    --muted: 0 0% 98%;
    --muted-foreground: 0 0% 45%;

    --accent: 0 0% 100%;
    --accent-foreground: 0 0% 20%;

    --destructive: 0 72% 51%;
    --destructive-foreground: 0 0% 100%;

    --border: 210 10% 90%;
    --input: 210 10% 90%;
    --ring: 217 91% 60%;

    --radius: 0.75rem;

    /* Accessibility enhancements */
    --contrast-high: 215 25% 10%;
    --focus-ring: 215 100% 55%;
    
    /* Chat specific */
    --chat-ernest: 215 100% 96%;
    --chat-user: 217 91% 60%;
    --chat-user-text: 0 0% 100%;
    
    /* Animations */
    --transition-base: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    --sidebar-background: 0 0% 98%;

    --sidebar-foreground: 240 5.3% 26.1%;

    --sidebar-primary: 240 5.9% 10%;

    --sidebar-primary-foreground: 0 0% 98%;

    --sidebar-accent: 240 4.8% 95.9%;

    --sidebar-accent-foreground: 240 5.9% 10%;

    --sidebar-border: 220 13% 91%;

    --sidebar-ring: 217 91% 60%;

    /* Chat bubble light surface (used in dark mode too) */
    --bubble: 0 0% 100%;
    --bubble-foreground: 0 0% 10%;
  }

  /* High contrast mode for accessibility */
  .high-contrast {
    --background: 0 0% 100%;
    --foreground: 0 0% 0%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 0%;
    --border: 0 0% 20%;
    --primary: 215 100% 35%;
    --contrast-high: 0 0% 0%;
  }

  /* Dark mode */
  .dark {
    --background: 222 47% 11%;
    --foreground: 0 0% 98%;

    --card: 222 47% 13%;
    --card-foreground: 0 0% 98%;

    --popover: 222 47% 13%;
    --popover-foreground: 0 0% 98%;

    --primary: 205 100% 60%;
    --primary-foreground: 0 0% 100%;
    --primary-glow: 205 100% 65%;

    --success: 142 71% 45%;
    --success-foreground: 0 0% 100%;
    --success-light: 142 71% 18%;

    --warning: 38 92% 50%;
    --warning-foreground: 0 0% 100%;
    --warning-light: 38 92% 20%;

    --error: 0 72% 51%;
    --error-foreground: 0 0% 100%;
    --error-light: 0 72% 20%;

    --secondary: 222 20% 16%;
    --secondary-foreground: 0 0% 98%;

    --muted: 222 20% 18%;
    --muted-foreground: 0 0% 80%;

    --accent: 222 20% 18%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 72% 51%;
    --destructive-foreground: 0 0% 100%;

    --border: 222 20% 20%;
    --input: 222 20% 20%;
    --ring: 205 100% 60%;

    /* Keep chat bubbles light in dark mode */
    --bubble: 0 0% 98%;
    --bubble-foreground: 0 0% 12%;
  }
}

@layer base {
  * {
    @apply border-border;
    box-sizing: border-box;
  }

  /* Empêche le défilement horizontal sur tout le document */
  html {
    overflow-x: hidden;
    width: 100%;
    -webkit-text-size-adjust: 100%;
  }

  body {
    overflow-x: hidden;
    width: 100%;
    min-width: 0;
    /* Hauteur dynamique sur mobile (évite la barre d’URL qui rétrécit le viewport) */
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* Root : pleine largeur, permet au flex de rétrécir, pas de débordement */
  #root {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    overflow-x: hidden;
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* S'assure que les conteneurs ne dépassent pas de leur parent */
  div, section, article, header, footer, main, aside, nav, figure, figcaption {
    min-width: 0;
    max-width: 100%;
  }

  /* Images et médias responsive par défaut */
  img, video, iframe, svg {
    max-width: 100%;
    height: auto;
  }

  body {
    @apply bg-background text-foreground;
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: clamp(15px, 4vw, 16px);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-wrap: break-word;
    word-wrap: break-word;
    /* Safe area pour encoches et barre d’accueil sur mobile */
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Text size modes - !important pour s'assurer que ces règles sont prioritaires */
  .text-mode-normal {
    font-size: 16px !important;
  }
  .text-mode-normal * {
    font-size: inherit !important;
  }

  .text-mode-large {
    font-size: 18px !important;
  }
  .text-mode-large * {
    font-size: inherit !important;
  }

  .text-mode-xl {
    font-size: 20px !important;
  }
  .text-mode-xl * {
    font-size: inherit !important;
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    /* Respect reduced motion for global transitions, but do NOT completely kill
       our core feedback/UX animations. Keep them short instead of 0.01ms which
       effectively disables them. */
    *,
    *::before,
    *::after {
      transition-duration: 0.15s !important;
    }

    /* Keep chat/message animations subtle but visible */
    .message-appear-active {
      animation-duration: 0.18s !important;
    }

    .typing-dot {
      animation-duration: 0.9s !important;
    }
  }
}

/* Animations pour les messages du chat */
@keyframes messageAppear {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Animation de frappe */
@keyframes typing {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.message-appear {
  opacity: 0;
  transform: translateY(8px);
  will-change: opacity, transform;
  transition: opacity 0.35s cubic-bezier(0.25, 0.1, 0.25, 1), 
              transform 0.35s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.message-appear-active {
  opacity: 1;
  transform: translateY(0);
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Animation pour les points de frappe */
.typing-dots span {
  animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: 0s; }
.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }

@layer utilities {
  /* Safe area pour encoches / barre d’accueil (mobile) */
  .safe-top { padding-top: env(safe-area-inset-top); }
  .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
  .safe-left { padding-left: env(safe-area-inset-left); }
  .safe-right { padding-right: env(safe-area-inset-right); }
  .safe-x { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
  .safe-y { padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
  .safe-area { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }

  /* Ernest Chat specific utilities */
  .chat-bubble {
    @apply rounded-[1.125rem] px-3 py-2.5 sm:px-4 sm:py-3 max-w-[92%] sm:max-w-[90%] mx-1;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .chat-bubble-ernest {
    background-color: hsl(var(--bubble));
    color: hsl(var(--bubble-foreground));
    @apply chat-bubble border border-border shadow-sm mr-2;
  }

  .chat-bubble-user {
    @apply chat-bubble bg-primary text-primary-foreground ml-2;
  }

  /* Variant when user's answer is correct (green) */
  .chat-bubble-user-correct {
    @apply chat-bubble bg-success-light text-success border border-success/40 shadow-sm ml-2;
  }

  /* Variant when user's answer is incorrect (grey) */
  .chat-bubble-user-incorrect {
    @apply chat-bubble bg-muted text-foreground/70 border border-border shadow-sm ml-2;
  }

  /* In dark mode, keep bubbles light for clarity */
  .dark .chat-bubble-ernest {
    background-color: hsl(var(--bubble));
    color: hsl(var(--bubble-foreground));
    @apply border border-border;
  }

  .dark .chat-bubble-user {
    background-color: hsl(var(--bubble));
    color: hsl(var(--bubble-foreground));
    @apply border border-border;
  }

  .btn-choice {
    @apply w-full rounded-[1.5rem] px-5 py-3.5 text-left font-medium transition-all
           border-[1.5px] border-border bg-card hover:border-primary hover:bg-primary/5
           focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1
           disabled:opacity-50 disabled:cursor-not-allowed text-[0.9375rem];
  }

  .btn-choice:hover {
    @apply transform -translate-y-[1px];
  }

  .btn-choice-correct {
    @apply bg-success-light border-success text-success;
  }

  .btn-choice-incorrect {
    @apply bg-error-light border-error text-error;
  }

  .module-card {
    @apply bg-card rounded-[1.25rem] p-4 border border-border
           transition-all hover:shadow-md hover:border-primary/30 cursor-pointer
           focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1;
  }

  .module-card:hover {
    @apply transform -translate-y-[1px];
  }

  .module-card-completed {
    @apply border-success/30 bg-success-light/30;
  }

  .badge-success {
    @apply inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
           bg-success-light text-success;
  }

  .badge-warning {
    @apply inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
           bg-warning-light text-warning;
  }

  /* Hide scrollbars for scroll containers */
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

  /* Typing indicator */
  .typing-dots {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    min-height: 1.2rem;
    padding: 0.3rem 0.6rem;
  }

  .typing-dot {
    width: 0.45rem;
    height: 0.45rem;
    border-radius: 50%;
    background: hsl(var(--primary));
    opacity: 0.4;
    will-change: transform, opacity;
    animation: typing-dot 1.4s infinite ease-in-out;
  }

  .typing-dot:nth-child(1) { animation-delay: 0s; }
  .typing-dot:nth-child(2) { animation-delay: 0.25s; }
  .typing-dot:nth-child(3) { animation-delay: 0.5s; }

  /* Animation d'apparition des messages */
  .message-appear {
    opacity: 0;
    transform: translateY(6px) scale(0.98);
    will-change: transform, opacity;
    /* État initial invisible mais présent dans le flux */
    visibility: visible;
    height: auto;
    overflow: hidden;
  }

  .message-appear-active {
    animation: message-appear 0.3s ease-out forwards;
  }
  
  @keyframes message-appear {
    from {
      opacity: 0;
      transform: translateY(6px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
}
